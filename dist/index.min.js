var d=/^(.*?)<([\w-]+?)(\s[^>]*)?>(.*?)(<\/\1>)?$/;function f(b){var a=b[3];a&&(a=a.replace(/ ([\w-]+?)="(.+?)"/g,',"$1":"$2"').substr(1));var c=g(b[4]);return'h("'+b[2]+'"'+(a?",{"+a+"}":"")+(c?",["+c.toString()+"]":"")+")"}
function g(b){if(!b)return null;var a=b.match(d);if(!a)return JSON.stringify(b);b=[];a[1]&&b.push(JSON.stringify(a[1]));if(a[5])return b.push(f(a)),b;var c=a[4].split("</"+a[2]+">");a[4]=2===c.length?c[0]:null;b.push(f(a));b.push(g(2===c.length?c[1]:c[0]));return b.filter(function(a){return a})}var h={"?":function(b,a){if(b)return a()},"^":function(b,a){if(!b)return a()},"#":function(b,a){return b.map(function(b){return a(b)})},"+":function(b,a){for(var c=[],e=0;e<b;e++)c.push(a(e));return c}};
module.exports=function(b,a){var c=g(b)[0];return(new Function("r","h","o","return "+c.replace(/{{([\#\?\^\+\/]?)(.+?)}}/g,"{{$1o.$2}}").replace(/"{{([\#\?\^\+])(.+?)}}",/g,'r["$1"]($2,function(v){return ').replace(/, "{{\/.+?}}"/g,"})").replace(/{{o\.\.}}/g,"{{v}}").replace(/{{o\.\.(.+?)}}/g,"{{v.$1}}").replace(/("{{|}}")/g,"").replace(/{{/g,'"+').replace(/}}/g,'+"'))).bind(null,h,a)};